<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Redirecting...</title>
    
    <script>
        // Function to get URL parameters
        function getQueryParam(param) {
            var searchParams = new URLSearchParams(window.location.search);
            return searchParams.get(param);
        }

        // Redirect to the URL specified in the 'url' query parameter

        function openLocalURLAndCloseTab(url) {
            
            // This is copied from mac-mouse-fix-website/public/activate/index.html
            // Notes from activate:
            // - The 10ms delay before installing onfocus is necessary for Firefox to not close immediately
            // - Closing the tab after 5s is because Chrome doesn't close the tab automatically after opening the URL
    
            window.location.href = url;
            setTimeout(function () { window.onfocus = function () { window.close(); }; }, 10);
            setTimeout(function () { window.close(); }, 5 * 1000);
        }

        function redirect() {

            var target = getQueryParam("target");
            if (!target) {
                document.getElementById("message").innerText = "No redirection target provided!";
                return
            }

            if (target == "macos-settings-loginitems") {
                window.location.href = openLocalURLAndCloseTab("x-apple.systempreferences:com.apple.LoginItems-Settings.extension");
            } else {
                document.getElementById("message").innerText = `Unknown redirection target ${target}.`;
            }
        }
    </script>
</head>
<body onload="redirect()">
    <p id="message"></p>
</body>
</html>